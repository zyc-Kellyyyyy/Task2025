
# YOLOv8 主干+Neck+检测头详细流程（Markdown版）

## 🎯 输入

```
Step 0: 输入图像
尺寸：1 × 3 × 640 × 640 （测试时）
实际训练：B × 3 × 640 × 640 （如 B = 4）
```

---

## 🔑 主干（Backbone）

| Step | 操作 | 输出尺寸 | 说明 |
|------|------|----------|------|
| 0 | Conv(3→16, k=3, s=2) | 1 × 16 × 320 × 320 | 步长2，下采样一半 |
| 1 | Conv(16→32, k=3, s=2) | 1 × 32 × 160 × 160 | 步长2，下采样一半 |
| 2 | C2f(32→32, n=1) | 1 × 32 × 160 × 160 | 轻量残差块，特征提取 |
| 3 | Conv(32→64, k=3, s=2) | 1 × 64 × 80 × 80 | 步长2，下采样一半 |
| 4 | C2f(64→64, n=2) | 1 × 64 × 80 × 80 | 轻量残差块，特征提取 |
| 5 | Conv(64→128, k=3, s=2) | 1 × 128 × 40 × 40 | 步长2，下采样一半 |
| 6 | C2f(128→128, n=2) | 1 × 128 × 40 × 40 | 轻量残差块，特征提取 |
| 7 | Conv(128→256, k=3, s=2) | 1 × 256 × 20 × 20 | 步长2，下采样一半 |
| 8 | C2f(256→256, n=1) | 1 × 256 × 20 × 20 | 轻量残差块，特征提取 |
| 9 | SPPF(256→256, k=5) | 1 × 256 × 20 × 20 | 空间金字塔池化，感受野更大 |
| 10 | Upsample(scale=2) | 1 × 256 × 40 × 40 | 上采样，分辨率 ×2 |

---

## 🔗 Neck (FPN + PAN)

| Step | 操作 | 输出尺寸 | 说明 |
|------|------|----------|------|
| 11 | Concat([Upsample, C2f128]) | 1 × 384 × 40 × 40 | 拼接，256+128=384 |
| 12 | C2f(384→128, n=1) | 1 × 128 × 40 × 40 | 轻量残差块，降通道 |
| 13 | Upsample(scale=2) | 1 × 128 × 80 × 80 | 上采样 |
| 14 | Concat([Upsample, C2f64]) | 1 × 192 × 80 × 80 | 拼接，128+64=192 |
| 15 | C2f(192→64, n=1) | 1 × 64 × 80 × 80 | 轻量残残块，降通道 |
| 16 | Conv(64→64, k=3, s=2) | 1 × 64 × 40 × 40 | 下采样 |
| 17 | Concat([Conv, C2f128]) | 1 × 192 × 40 × 40 | 拼接，64+128=192 |
| 18 | C2f(192→128, n=1) | 1 × 128 × 40 × 40 | 轻量残差块，降通道 |
| 19 | Conv(128→128, k=3, s=2) | 1 × 128 × 20 × 20 | 下采样 |
| 20 | Concat([Conv, C2f256]) | 1 × 384 × 20 × 20 | 拼接，128+256=384 |
| 21 | C2f(384→256, n=1) | 1 × 256 × 20 × 20 | 轻量残差块，降通道 |

---

## 🎯 检测头

| 分支 | 尺寸 | 说明 |
|------|------|------|
| 小目标 | 1 × 64 × 80 × 80 | 来自 Step 15 |
| 中目标 | 1 × 128 × 40 × 40 | 来自 Step 18 |
| 大目标 | 1 × 256 × 20 × 20 | 来自 Step 21 |

最终通过 `Detect` 头，输出类别概率和边框坐标。

---

## 🚩 总结

- **主干**：逐层下采样，提取多层特征  
- **Neck**：上采样+拼接+下采样，多尺度信息融合  
- **检测头**：输出三个分支，分别适配小/中/大目标检测

✅ 提示：训练时，batch size 替换 `1` → `B` 即可。
